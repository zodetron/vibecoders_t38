<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portfolio Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
    h1 { color: #333; }
    .card { background: #fff; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, button { margin: 5px 0; padding: 10px; width: 100%; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #007bff; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    #userInfo { display: none; }
  </style>
</head>
<body>
  <h1>Investment Portfolio Manager</h1>

  <!-- Register Form -->
  <div class="card">
    <h2>Register</h2>
    <input type="email" id="regEmail" placeholder="Email">
    <input type="password" id="regPassword" placeholder="Password">
    <button onclick="register()">Register</button>
    <p id="regMsg"></p>
  </div>

  <!-- Login Form -->
  <div class="card">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginMsg"></p>
  </div>

  <!-- User Info -->
  <div id="userInfo" class="card">
    <h2>Welcome, <span id="userEmail"></span></h2>
    <p><strong>Balance:</strong> â‚¹<span id="userBalance"></span></p>
    <p><strong>Holdings:</strong> <span id="userHoldings"></span></p>
  </div>




  <!-- Ads section (visible only for free users) -->
<div id="adsCard" class="card" style="display:none; background:#ffeeba;">
  <h3>Sponsored Ad</h3>
  <p>ðŸš€ Invest smarter with ProTips! Get AI-based suggestions now.</p>
</div>

<!-- Upgrade to Premium -->
<div id="premiumCard" class="card" style="display:none;">
  <h3>Go Premium ðŸš€</h3>
  <p>No Ads + Extra Features</p>
  <button onclick="subscribe()">Upgrade Now</button>
  <p id="subMsg"></p>
</div>


<script>
  let currentUser = null;

  function login() {
    fetch("/api/login", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        email: document.getElementById("loginEmail").value,
        password: document.getElementById("loginPassword").value
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.user) {
        currentUser = data.user;

        document.getElementById("registerCard").style.display = "none";
        document.getElementById("loginCard").style.display = "none";
        document.getElementById("dashboard").style.display = "block";

        document.getElementById("userEmail").innerText = data.user.email;
        document.getElementById("userBalance").innerText = data.user.balance;
        renderHoldings(data.user.holdings);

        // Show ads only if not premium
        if (!data.user.is_premium) {
          document.getElementById("adsCard").style.display = "block";
          document.getElementById("premiumCard").style.display = "block";
        }
      } else {
        document.getElementById("loginMsg").innerText = data.error;
      }
    });
  }

  function subscribe() {
    fetch("/api/subscribe", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ email: currentUser.email })
    })
    .then(res => res.json())
    .then(data => {
      if (data.user && data.user.is_premium) {
        document.getElementById("adsCard").style.display = "none";
        document.getElementById("premiumCard").style.display = "none";
        document.getElementById("subMsg").innerText = "âœ… You are now Premium!";
      }
    });
  }





   // Register user
    function register() {
      fetch("/api/register", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          email: document.getElementById("regEmail").value,
          password: document.getElementById("regPassword").value
        })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("regMsg").innerText = data.message || data.error;
      });
    }

    // Login user
    function login() {
      fetch("/api/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          email: document.getElementById("loginEmail").value,
          password: document.getElementById("loginPassword").value
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.user) {
          document.getElementById("loginMsg").innerText = data.message;
          document.getElementById("userEmail").innerText = data.user.email;
          document.getElementById("userBalance").innerText = data.user.balance;
          document.getElementById("userHoldings").innerText = data.user.holdings;
          document.getElementById("userInfo").style.display = "block";
        } else {
          document.getElementById("loginMsg").innerText = data.error;
        }
      });
    }

</script>
</body>
</html>
